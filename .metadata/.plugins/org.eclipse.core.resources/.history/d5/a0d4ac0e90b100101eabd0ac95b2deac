package pe.com.arreglago.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import pe.com.arreglago.entity.UsuarioEntity;
import pe.com.arreglago.entity.ProveedorEntity;
import pe.com.arreglago.service.UsuarioService;
import pe.com.arreglago.service.ProveedorService;

@Controller
@RequestMapping("/profesional")
public class ProfesionalController {

    @Autowired
    private UsuarioService usuarioService;

    @Autowired
    private ProveedorService proveedorService;

    // Mostrar el formulario de registro de profesional
    @GetMapping("/registro")
    public String mostrarFormulario(Model model) {
        model.addAttribute("usuario", new UsuarioEntity());
        model.addAttribute("proveedor", new ProveedorEntity());
        return "profesional-registro";
    }

    // Guardar el profesional
    @PostMapping("/registro")
    public String registrarProveedor(@ModelAttribute UsuarioEntity usuario,
                                     @ModelAttribute ProveedorEntity proveedor) {
        // 1. Guardamos primero el usuario
        usuario.setEstado(true);
        UsuarioEntity usuarioGuardado = usuarioService.add(usuario);

        // 2. Asociamos el usuario al proveedor
        proveedor.setUsuario(usuarioGuardado);
        proveedor.setEstado(true);
        proveedorService.add(proveedor);

        // 3. Redirigimos al menú principal (o página de confirmación)
        return "redirect:/menuprincipal";
    }
}
